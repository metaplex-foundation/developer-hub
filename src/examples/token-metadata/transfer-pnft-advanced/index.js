/**
 * Example: transfer-pnft-advanced
 *
 * 
 *
 * This file is auto-generated by scripts/build-examples.js
 * Edit the native .js and .rs files, then run: node scripts/build-examples.js
 */

const kitSections = {
  "imports": "import { address } from '@solana/addresses';\nimport {\n  getTransferV1InstructionAsync,\n  TokenStandard,\n} from '@metaplex-foundation/mpl-token-metadata-kit';",
  "setup": "// Assuming rpc, sendAndConfirm, and authority are set up\n\nconst mintAddress = address('mintAddress...'); // Your pNFT mint address\nconst currentOwner = authority.address;\nconst destinationOwner = address('destinationWallet...'); // Destination wallet",
  "main": "// For pNFTs with auth rules, the SDK handles most resolution automatically\nconst transferIx = await getTransferV1InstructionAsync({\n  mint: mintAddress,\n  tokenOwner: currentOwner,\n  destinationOwner,\n  authority,\n  payer: authority,\n  tokenStandard: TokenStandard.ProgrammableNonFungible,\n  // Auth rules are resolved automatically when available\n});\n\nawait sendAndConfirm([transferIx], [authority]);",
  "output": "console.log('pNFT transferred to:', destinationOwner);",
  "full": "// [IMPORTS]\nimport { address } from '@solana/addresses';\nimport {\n  getTransferV1InstructionAsync,\n  TokenStandard,\n} from '@metaplex-foundation/mpl-token-metadata-kit';\n// [/IMPORTS]\n\n// [SETUP]\n// Assuming rpc, sendAndConfirm, and authority are set up\n\nconst mintAddress = address('mintAddress...'); // Your pNFT mint address\nconst currentOwner = authority.address;\nconst destinationOwner = address('destinationWallet...'); // Destination wallet\n// [/SETUP]\n\n// [MAIN]\n// For pNFTs with auth rules, the SDK handles most resolution automatically\nconst transferIx = await getTransferV1InstructionAsync({\n  mint: mintAddress,\n  tokenOwner: currentOwner,\n  destinationOwner,\n  authority,\n  payer: authority,\n  tokenStandard: TokenStandard.ProgrammableNonFungible,\n  // Auth rules are resolved automatically when available\n});\n\nawait sendAndConfirm([transferIx], [authority]);\n// [/MAIN]\n\n// [OUTPUT]\nconsole.log('pNFT transferred to:', destinationOwner);\n// [/OUTPUT]\n"
}

const umiSections = {
  "imports": "import { getMplTokenAuthRulesProgramId } from '@metaplex-foundation/mpl-candy-machine';\nimport {\n  fetchDigitalAssetWithAssociatedToken,\n  findTokenRecordPda,\n  TokenStandard,\n  transferV1,\n} from '@metaplex-foundation/mpl-token-metadata';\nimport { findAssociatedTokenPda } from '@metaplex-foundation/mpl-toolbox';\nimport { publicKey, unwrapOptionRecursively } from '@metaplex-foundation/umi';\nimport { base58 } from '@metaplex-foundation/umi/serializers';",
  "setup": "// The NFT Asset Mint ID\nconst mintId = publicKey('11111111111111111111111111111111');\n\n// The destination wallet\nconst destinationAddress = publicKey('22222222222222222222222222222222');",
  "main": "// Fetch the pNFT Asset with the Token Account\nconst assetWithToken = await fetchDigitalAssetWithAssociatedToken(\n  umi,\n  mintId,\n  umi.identity.publicKey\n);\n\n// Calculates the destination wallet's Token Account\nconst destinationTokenAccount = findAssociatedTokenPda(umi, {\n  mint: mintId,\n  owner: destinationAddress,\n});\n\n// Calculates the destinations wallet's Token Record Account\nconst destinationTokenRecord = findTokenRecordPda(umi, {\n  mint: mintId,\n  token: destinationTokenAccount[0],\n});\n\n// Transfer the pNFT\nconst { signature } = await transferV1(umi, {\n  mint: mintId,\n  destinationOwner: destinationAddress,\n  destinationTokenRecord: destinationTokenRecord,\n  tokenRecord: assetWithToken.tokenRecord?.publicKey,\n  tokenStandard: TokenStandard.ProgrammableNonFungible,\n  // Check to see if the pNFT asset as auth rules.\n  authorizationRules:\n    unwrapOptionRecursively(assetWithToken.metadata.programmableConfig)\n      ?.ruleSet || undefined,\n  // Auth rules program ID\n  authorizationRulesProgram: getMplTokenAuthRulesProgramId(umi),\n  // Some pNFTs may require authorization data if set.\n  authorizationData: undefined,\n}).sendAndConfirm(umi);",
  "output": "console.log('Signature:', base58.deserialize(signature));",
  "full": "// [IMPORTS]\nimport { getMplTokenAuthRulesProgramId } from '@metaplex-foundation/mpl-candy-machine';\nimport {\n  fetchDigitalAssetWithAssociatedToken,\n  findTokenRecordPda,\n  TokenStandard,\n  transferV1,\n} from '@metaplex-foundation/mpl-token-metadata';\nimport { findAssociatedTokenPda } from '@metaplex-foundation/mpl-toolbox';\nimport { publicKey, unwrapOptionRecursively } from '@metaplex-foundation/umi';\nimport { base58 } from '@metaplex-foundation/umi/serializers';\n// [/IMPORTS]\n\n// [SETUP]\n// The NFT Asset Mint ID\nconst mintId = publicKey('11111111111111111111111111111111');\n\n// The destination wallet\nconst destinationAddress = publicKey('22222222222222222222222222222222');\n// [/SETUP]\n\n// [MAIN]\n// Fetch the pNFT Asset with the Token Account\nconst assetWithToken = await fetchDigitalAssetWithAssociatedToken(\n  umi,\n  mintId,\n  umi.identity.publicKey\n);\n\n// Calculates the destination wallet's Token Account\nconst destinationTokenAccount = findAssociatedTokenPda(umi, {\n  mint: mintId,\n  owner: destinationAddress,\n});\n\n// Calculates the destinations wallet's Token Record Account\nconst destinationTokenRecord = findTokenRecordPda(umi, {\n  mint: mintId,\n  token: destinationTokenAccount[0],\n});\n\n// Transfer the pNFT\nconst { signature } = await transferV1(umi, {\n  mint: mintId,\n  destinationOwner: destinationAddress,\n  destinationTokenRecord: destinationTokenRecord,\n  tokenRecord: assetWithToken.tokenRecord?.publicKey,\n  tokenStandard: TokenStandard.ProgrammableNonFungible,\n  // Check to see if the pNFT asset as auth rules.\n  authorizationRules:\n    unwrapOptionRecursively(assetWithToken.metadata.programmableConfig)\n      ?.ruleSet || undefined,\n  // Auth rules program ID\n  authorizationRulesProgram: getMplTokenAuthRulesProgramId(umi),\n  // Some pNFTs may require authorization data if set.\n  authorizationData: undefined,\n}).sendAndConfirm(umi);\n// [/MAIN]\n\n// [OUTPUT]\nconsole.log('Signature:', base58.deserialize(signature));\n// [/OUTPUT]\n"
}

export const metadata = {
  title: "transfer-pnft-advanced",
  description: "",
  tags: [],
}

export const examples = {
  kit: {
    framework: 'Kit',
    language: 'javascript',
    code: kitSections.full,
    sections: kitSections,
  },

  umi: {
    framework: 'Umi',
    language: 'javascript',
    code: umiSections.full,
    sections: umiSections,
  },

}
